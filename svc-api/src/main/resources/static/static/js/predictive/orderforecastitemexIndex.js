var datagridData_orderforecastitemex = {
    'data': {
        'records': [
            {
                'channelCode': '', sortable: true,
                'productType': '总计', sortable: true,
                'saleQty': '61', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '33247', sortable: true,
                'realDifferQty': '33186', sortable: true,
                'realRightRate': '0', sortable: true
            },
            {
                'channelCode': '商城渠道', sortable: true,
                'productType': '洗衣机', sortable: true,
                'saleQty': '3', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '2330', sortable: true,
                'realDifferQty': '2327', sortable: true,
                'realRightRate': '0.13%', sortable: true
            },
            {
                'channelCode': '商城渠道', sortable: true,
                'productType': '热水器', sortable: true,
                'saleQty': '3', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '2330', sortable: true,
                'realDifferQty': '2327', sortable: true,
                'realRightRate': '0.13%', sortable: true
            },
            {
                'channelCode': '商城渠道', sortable: true,
                'productType': '厨电', sortable: true,
                'saleQty': '3', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '2330', sortable: true,
                'realDifferQty': '2327', sortable: true,
                'realRightRate': '0.13%', sortable: true
            },
            {
                'channelCode': '商城渠道', sortable: true,
                'productType': '冰箱', sortable: true,
                'saleQty': '3', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '2330', sortable: true,
                'realDifferQty': '2327', sortable: true,
                'realRightRate': '0.13%', sortable: true
            },
            {
                'channelCode': '商城渠道', sortable: true,
                'productType': '冷柜', sortable: true,
                'saleQty': '3', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '2330', sortable: true,
                'realDifferQty': '2327', sortable: true,
                'realRightRate': '0.13%', sortable: true
            },
            {
                'channelCode': ' ', sortable: true,
                'productType': '小计', sortable: true,
                'saleQty': '3', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '2330', sortable: true,
                'realDifferQty': '2327', sortable: true,
                'realRightRate': '0.13%', sortable: true
            },

            {
                'channelCode': '大客户渠道', sortable: true,
                'productType': '热水器', sortable: true,
                'saleQty': '0', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '35', sortable: true,
                'realDifferQty': '35', sortable: true,
                'realRightRate': '0', sortable: true
            },
            {
                'channelCode': '大客户渠道', sortable: true,
                'productType': '冰箱', sortable: true,
                'saleQty': '9', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '335', sortable: true,
                'realDifferQty': '326', sortable: true,
                'realRightRate': '2.69%', sortable: true
            },
            {
                'channelCode': ' ', sortable: true,
                'productType': '小计', sortable: true,
                'saleQty': '9', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '370', sortable: true,
                'realDifferQty': '361', sortable: true,
                'realRightRate': '2.43%', sortable: true
            },

            {
                'channelCode': '天猫渠道', sortable: true,
                'productType': '空调', sortable: true,
                'saleQty': '1', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '2169', sortable: true,
                'realDifferQty': '2168', sortable: true,
                'realRightRate': '0.05%', sortable: true
            },
            {
                'channelCode': '天猫渠道', sortable: true,
                'productType': '冷柜', sortable: true,
                'saleQty': '0', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '993', sortable: true,
                'realDifferQty': '993', sortable: true,
                'realRightRate': '0', sortable: true
            },
            {
                'channelCode': '天猫渠道', sortable: true,
                'productType': '洗衣机', sortable: true,
                'saleQty': '4', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '1177', sortable: true,
                'realDifferQty': '1173', sortable: true,
                'realRightRate': '0.34%', sortable: true
            },{
                'channelCode': '天猫渠道', sortable: true,
                'productType': '冰箱', sortable: true,
                'saleQty': '1', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '5081', sortable: true,
                'realDifferQty': '5080', sortable: true,
                'realRightRate': '0.02%', sortable: true
            },
            {
                'channelCode': '天猫渠道', sortable: true,
                'productType': '厨电', sortable: true,
                'saleQty': '0', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '213', sortable: true,
                'realDifferQty': '213', sortable: true,
                'realRightRate': '0', sortable: true
            },
            {
                'channelCode': '天猫渠道', sortable: true,
                'productType': '热水器', sortable: true,
                'saleQty': '0', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '0', sortable: true,

                'realSaleQty': '2126', sortable: true,
                'realDifferQty': '2126', sortable: true,
                'realRightRate': '2.43%', sortable: true
            },{
                'channelCode': '天猫渠道', sortable: true,
                'productType': '彩电', sortable: true,
                'saleQty': '29', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '2792', sortable: true,
                'realDifferQty': '2763', sortable: true,
                'realRightRate': '1.04%', sortable: true
            },
            {
                'channelCode': '天猫渠道', sortable: true,
                'productType': '数码', sortable: true,
                'saleQty': '9', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '0', sortable: true,
                'realDifferQty': '0', sortable: true,
                'realRightRate': '--', sortable: true
            },
            {
                'channelCode': ' ', sortable: true,
                'productType': '小计', sortable: true,
                'saleQty': '44', sortable: true,
                'modelForecastQty': '0', sortable: true,
                'modelDifferQty': '0', sortable: true,
                'modelRightRate': '--', sortable: true,

                'realSaleQty': '14551', sortable: true,
                'realDifferQty': '14516', sortable: true,
                'realRightRate': '0.24%', sortable: true
            },

        ], 'totalCount': 10
    }
};

var datagridOptions_orderforecastitemex = {
    fit: true,
    fitColumns: true,
    singleSelect: true,
    //url: '/predictive/orderforecastitemex/p',
   /* frozenColumns: [[{
        field: 'id', checkbox: true
    }]],*/
    columns: [[
        {title: '渠道', field: 'channelCode', sortable: true, rowspan: 2},
        {title: '品类', field: 'productType', sortable: true, rowspan: 2},
        {title: '销售量', field: 'saleQty', sortable: true, rowspan: 2},

        {title: '预测模型预测准确率', field: 'modelType', sortable: true, colspan: 3},
        {title: '实际采购预测准确率', field: 'realType', sortable: true, colspan: 3}],
        [
            {title: '预测数', field: 'modelForecastQty', sortable: true},
            {title: '差异数', field: 'modelDifferQty', sortable: true},
            {title: '准确率', field: 'modelRightRate', sortable: true},
            {title: '预测数', field: 'realSaleQty', sortable: true},
            {title: '差异数', field: 'realDifferQty', sortable: true},
            {title: '准确率', field: 'realRightRate', sortable: true}

        ]],
    toolbar: '#datagridToolbar_orderforecastitemex',
    striped: true,
    pagination: false,
    rownumbers: false,
};
$(function () {
    var datagrid = $('#datagrid_orderforecastitemex').datagrid(datagridOptions_orderforecastitemex);
    datagrid.datagrid('loadData', datagridData_orderforecastitemex);
    $('#datagrid_orderforecastitemex').datagrid("autoMergeCells", ['channelCode']);
    //创建表头的菜单
    //CustomConfig.load(datagrid,"Orderforecastitemex");
    //$("#searchPanel_orderforecastitemex").panel('resize');

    /*$("#searchBtn_orderforecastitemex").on('click', function (event) {
     var param = $('#paramForm_orderforecastitemex').serializeObject();
     datagrid.datagrid({queryParams: param});
     event.preventDefault();
     });*/
    $("#tipsBtn_orderforecastitemex").on('click', function (event) {
        $('#addForm_orderforecastitemex').form('reset');
        $('#addForm_orderforecastitemex').find('[__actType]').val('add');
        $('#addDlg_orderforecastitemex').dialog({'title': '预测准确率提示信息'});
        $('#addDlg_orderforecastitemex').dialog('open');
    });
    /*$("#addDlgSaveBtn_orderforecastitemex").on('click', function () {
     if (!$('#addForm_orderforecastitemex').form('validate')) {
     return;
     }
     var actType = $('#addForm_orderforecastitemex').find('[__actType]').val();
     if (actType === 'add') {
     alert('新增成功');
     } else {
     alert('编辑成功');
     }
     $('#addDlg_orderforecastitemex').dialog('close');
     });
     $("#editBtn_orderforecastitemex").on('click', function () {
     var selected = datagrid.datagrid('getSelected');
     $('#addDlg_orderforecastitemex').dialog({'title': '修改'});
     if (selected !== null) {
     $('#addForm_orderforecastitemex').form('load', selected);
     $('#addForm_orderforecastitemex').find('[__actType]').val('edit');
     $('#addDlg_orderforecastitemex').dialog('open');
     } else {
     alert('请选择一条数据');
     }
     });
     $("#deleteBtn_orderforecastitemex").on('click', function (event) {
     event.preventDefault();
     var selected = datagrid.datagrid('getSelected');
     if (selected !== null) {
     confirm('确定删除？', function (r) {
     if (r) {
     alert('删除成功');
     }
     })

     } else {
     alert('请选择一条数据');
     }
     });*/
    $("#resetBtn_orderforecastitemex").on('click', function (event) {
        event.preventDefault();
        $('#paramForm_orderforecastitemex').form('reset');
    });
});

$.extend($.fn.datagrid.methods, {

    autoMergeCells: function (jq, fields) {

        return jq.each(function () {

            var target = $(this);

            if (!fields) {

                fields = target.datagrid("getColumnFields");

            }

            var rows = target.datagrid("getRows");

            var i = 0,

                j = 0,

                temp = {};

            for (i; i < rows.length; i++) {

                var row = rows[i];

                j = 0;

                for (j; j < fields.length; j++) {

                    var field = fields[j];

                    var tf = temp[field];

                    if (!tf) {

                        tf = temp[field] = {};

                        tf[row[field]] = [i];

                    } else {

                        var tfv = tf[row[field]];

                        if (tfv) {

                            tfv.push(i);

                        } else {

                            tfv = tf[row[field]] = [i];

                        }

                    }                }

            }

            $.each(temp, function (field, colunm) {

                $.each(colunm, function () {

                    var group = this;



                    if (group.length > 1) {

                        var before,

                            after,

                            megerIndex = group[0];

                        for (var i = 0; i < group.length; i++) {

                            before = group[i];

                            after = group[i + 1];

                            if (after && (after - before) == 1) {

                                continue;

                            }

                            var rowspan = before - megerIndex + 1;

                            if (rowspan > 1) {

                                target.datagrid('mergeCells', {

                                    index: megerIndex,

                                    field: field,

                                    rowspan: rowspan

                                });

                            }

                            if (after && (after - before) != 1) {

                                megerIndex = after;

                            }

                        }

                    }

                });

            });

        });

    }

});
