/*
var datagridData_purchaseOrder={'data':{'records':[
      {
          'poId':'自增ID'+'100',sortable:true,
          'poNo':'采购订单编号'+'100',sortable:true,
          'channelCode':''+'100',sortable:true,
          'suplier':''+'100',sortable:true,
          'soldTo':'售达方'+'100',sortable:true,
          'deliveryTo':'送达方'+'100',sortable:true,
          'amount':'采购订单金额（2位小数）'+'100',sortable:true,
          'poTime':'采购日期'+'100',sortable:true,
          'type':'采购订单类型(ZBCR，采购入库订单)'+'100',sortable:true,
          'receiver':'收货人姓名'+'100',sortable:true,
          'mobile':'收货人移动电话'+'100',sortable:true,
          'telephone':'收货人固定电话'+'100',sortable:true,
          'province':'收货人所在省'+'100',sortable:true,
          'city':'收货人所在市'+'100',sortable:true,
          'county':'收货人所在区/县'+'100',sortable:true,
          'address':'收货人地址'+'100',sortable:true,
          'status':'采购订单状态，100：新建 200：完成'+'100',sortable:true,
          'createTime':'创建时间'+'100',sortable:true,
          'updateTime':'更新时间'+'100',sortable:true,
      },
      {
          'poId':'自增ID'+'100',sortable:true,
          'poNo':'采购订单编号'+'100',sortable:true,
          'channelCode':''+'100',sortable:true,
          'suplier':''+'100',sortable:true,
          'soldTo':'售达方'+'100',sortable:true,
          'deliveryTo':'送达方'+'100',sortable:true,
          'amount':'采购订单金额（2位小数）'+'100',sortable:true,
          'poTime':'采购日期'+'100',sortable:true,
          'type':'采购订单类型(ZBCR，采购入库订单)'+'100',sortable:true,
          'receiver':'收货人姓名'+'100',sortable:true,
          'mobile':'收货人移动电话'+'100',sortable:true,
          'telephone':'收货人固定电话'+'100',sortable:true,
          'province':'收货人所在省'+'100',sortable:true,
          'city':'收货人所在市'+'100',sortable:true,
          'county':'收货人所在区/县'+'100',sortable:true,
          'address':'收货人地址'+'100',sortable:true,
          'status':'采购订单状态，100：新建 200：完成'+'100',sortable:true,
          'createTime':'创建时间'+'100',sortable:true,
          'updateTime':'更新时间'+'100',sortable:true,
      },
      {
          'poId':'自增ID'+'100',sortable:true,
          'poNo':'采购订单编号'+'100',sortable:true,
          'channelCode':''+'100',sortable:true,
          'suplier':''+'100',sortable:true,
          'soldTo':'售达方'+'100',sortable:true,
          'deliveryTo':'送达方'+'100',sortable:true,
          'amount':'采购订单金额（2位小数）'+'100',sortable:true,
          'poTime':'采购日期'+'100',sortable:true,
          'type':'采购订单类型(ZBCR，采购入库订单)'+'100',sortable:true,
          'receiver':'收货人姓名'+'100',sortable:true,
          'mobile':'收货人移动电话'+'100',sortable:true,
          'telephone':'收货人固定电话'+'100',sortable:true,
          'province':'收货人所在省'+'100',sortable:true,
          'city':'收货人所在市'+'100',sortable:true,
          'county':'收货人所在区/县'+'100',sortable:true,
          'address':'收货人地址'+'100',sortable:true,
          'status':'采购订单状态，100：新建 200：完成'+'100',sortable:true,
          'createTime':'创建时间'+'100',sortable:true,
          'updateTime':'更新时间'+'100',sortable:true,
      },
      {
          'poId':'自增ID'+'100',sortable:true,
          'poNo':'采购订单编号'+'100',sortable:true,
          'channelCode':''+'100',sortable:true,
          'suplier':''+'100',sortable:true,
          'soldTo':'售达方'+'100',sortable:true,
          'deliveryTo':'送达方'+'100',sortable:true,
          'amount':'采购订单金额（2位小数）'+'100',sortable:true,
          'poTime':'采购日期'+'100',sortable:true,
          'type':'采购订单类型(ZBCR，采购入库订单)'+'100',sortable:true,
          'receiver':'收货人姓名'+'100',sortable:true,
          'mobile':'收货人移动电话'+'100',sortable:true,
          'telephone':'收货人固定电话'+'100',sortable:true,
          'province':'收货人所在省'+'100',sortable:true,
          'city':'收货人所在市'+'100',sortable:true,
          'county':'收货人所在区/县'+'100',sortable:true,
          'address':'收货人地址'+'100',sortable:true,
          'status':'采购订单状态，100：新建 200：完成'+'100',sortable:true,
          'createTime':'创建时间'+'100',sortable:true,
          'updateTime':'更新时间'+'100',sortable:true,
      },
      {
          'poId':'自增ID'+'100',sortable:true,
          'poNo':'采购订单编号'+'100',sortable:true,
          'channelCode':''+'100',sortable:true,
          'suplier':''+'100',sortable:true,
          'soldTo':'售达方'+'100',sortable:true,
          'deliveryTo':'送达方'+'100',sortable:true,
          'amount':'采购订单金额（2位小数）'+'100',sortable:true,
          'poTime':'采购日期'+'100',sortable:true,
          'type':'采购订单类型(ZBCR，采购入库订单)'+'100',sortable:true,
          'receiver':'收货人姓名'+'100',sortable:true,
          'mobile':'收货人移动电话'+'100',sortable:true,
          'telephone':'收货人固定电话'+'100',sortable:true,
          'province':'收货人所在省'+'100',sortable:true,
          'city':'收货人所在市'+'100',sortable:true,
          'county':'收货人所在区/县'+'100',sortable:true,
          'address':'收货人地址'+'100',sortable:true,
          'status':'采购订单状态，100：新建 200：完成'+'100',sortable:true,
          'createTime':'创建时间'+'100',sortable:true,
          'updateTime':'更新时间'+'100',sortable:true,
      },
      {
          'poId':'自增ID'+'100',sortable:true,
          'poNo':'采购订单编号'+'100',sortable:true,
          'channelCode':''+'100',sortable:true,
          'suplier':''+'100',sortable:true,
          'soldTo':'售达方'+'100',sortable:true,
          'deliveryTo':'送达方'+'100',sortable:true,
          'amount':'采购订单金额（2位小数）'+'100',sortable:true,
          'poTime':'采购日期'+'100',sortable:true,
          'type':'采购订单类型(ZBCR，采购入库订单)'+'100',sortable:true,
          'receiver':'收货人姓名'+'100',sortable:true,
          'mobile':'收货人移动电话'+'100',sortable:true,
          'telephone':'收货人固定电话'+'100',sortable:true,
          'province':'收货人所在省'+'100',sortable:true,
          'city':'收货人所在市'+'100',sortable:true,
          'county':'收货人所在区/县'+'100',sortable:true,
          'address':'收货人地址'+'100',sortable:true,
          'status':'采购订单状态，100：新建 200：完成'+'100',sortable:true,
          'createTime':'创建时间'+'100',sortable:true,
          'updateTime':'更新时间'+'100',sortable:true,
      },
      {
          'poId':'自增ID'+'100',sortable:true,
          'poNo':'采购订单编号'+'100',sortable:true,
          'channelCode':''+'100',sortable:true,
          'suplier':''+'100',sortable:true,
          'soldTo':'售达方'+'100',sortable:true,
          'deliveryTo':'送达方'+'100',sortable:true,
          'amount':'采购订单金额（2位小数）'+'100',sortable:true,
          'poTime':'采购日期'+'100',sortable:true,
          'type':'采购订单类型(ZBCR，采购入库订单)'+'100',sortable:true,
          'receiver':'收货人姓名'+'100',sortable:true,
          'mobile':'收货人移动电话'+'100',sortable:true,
          'telephone':'收货人固定电话'+'100',sortable:true,
          'province':'收货人所在省'+'100',sortable:true,
          'city':'收货人所在市'+'100',sortable:true,
          'county':'收货人所在区/县'+'100',sortable:true,
          'address':'收货人地址'+'100',sortable:true,
          'status':'采购订单状态，100：新建 200：完成'+'100',sortable:true,
          'createTime':'创建时间'+'100',sortable:true,
          'updateTime':'更新时间'+'100',sortable:true,
      },
      {
          'poId':'自增ID'+'100',sortable:true,
          'poNo':'采购订单编号'+'100',sortable:true,
          'channelCode':''+'100',sortable:true,
          'suplier':''+'100',sortable:true,
          'soldTo':'售达方'+'100',sortable:true,
          'deliveryTo':'送达方'+'100',sortable:true,
          'amount':'采购订单金额（2位小数）'+'100',sortable:true,
          'poTime':'采购日期'+'100',sortable:true,
          'type':'采购订单类型(ZBCR，采购入库订单)'+'100',sortable:true,
          'receiver':'收货人姓名'+'100',sortable:true,
          'mobile':'收货人移动电话'+'100',sortable:true,
          'telephone':'收货人固定电话'+'100',sortable:true,
          'province':'收货人所在省'+'100',sortable:true,
          'city':'收货人所在市'+'100',sortable:true,
          'county':'收货人所在区/县'+'100',sortable:true,
          'address':'收货人地址'+'100',sortable:true,
          'status':'采购订单状态，100：新建 200：完成'+'100',sortable:true,
          'createTime':'创建时间'+'100',sortable:true,
          'updateTime':'更新时间'+'100',sortable:true,
      },
      {
          'poId':'自增ID'+'100',sortable:true,
          'poNo':'采购订单编号'+'100',sortable:true,
          'channelCode':''+'100',sortable:true,
          'suplier':''+'100',sortable:true,
          'soldTo':'售达方'+'100',sortable:true,
          'deliveryTo':'送达方'+'100',sortable:true,
          'amount':'采购订单金额（2位小数）'+'100',sortable:true,
          'poTime':'采购日期'+'100',sortable:true,
          'type':'采购订单类型(ZBCR，采购入库订单)'+'100',sortable:true,
          'receiver':'收货人姓名'+'100',sortable:true,
          'mobile':'收货人移动电话'+'100',sortable:true,
          'telephone':'收货人固定电话'+'100',sortable:true,
          'province':'收货人所在省'+'100',sortable:true,
          'city':'收货人所在市'+'100',sortable:true,
          'county':'收货人所在区/县'+'100',sortable:true,
          'address':'收货人地址'+'100',sortable:true,
          'status':'采购订单状态，100：新建 200：完成'+'100',sortable:true,
          'createTime':'创建时间'+'100',sortable:true,
          'updateTime':'更新时间'+'100',sortable:true,
      },
      {
          'poId':'自增ID'+'100',sortable:true,
          'poNo':'采购订单编号'+'100',sortable:true,
          'channelCode':''+'100',sortable:true,
          'suplier':''+'100',sortable:true,
          'soldTo':'售达方'+'100',sortable:true,
          'deliveryTo':'送达方'+'100',sortable:true,
          'amount':'采购订单金额（2位小数）'+'100',sortable:true,
          'poTime':'采购日期'+'100',sortable:true,
          'type':'采购订单类型(ZBCR，采购入库订单)'+'100',sortable:true,
          'receiver':'收货人姓名'+'100',sortable:true,
          'mobile':'收货人移动电话'+'100',sortable:true,
          'telephone':'收货人固定电话'+'100',sortable:true,
          'province':'收货人所在省'+'100',sortable:true,
          'city':'收货人所在市'+'100',sortable:true,
          'county':'收货人所在区/县'+'100',sortable:true,
          'address':'收货人地址'+'100',sortable:true,
          'status':'采购订单状态，100：新建 200：完成'+'100',sortable:true,
          'createTime':'创建时间'+'100',sortable:true,
          'updateTime':'更新时间'+'100',sortable:true,
      },
],'total':10}};

var datagridOptions_purchaseOrder = {
  fit: true,
  fitColumns: true,
  singleSelect: true,
  //url: '/auth/purchaseOrder/p',
  frozenColumns: [[{
    field: 'id', checkbox: true
  }]],
  columns: [[
        {title: '自增ID', field: 'poId',sortable:true},
        {title: '采购订单编号', field: 'poNo',sortable:true},
        {title: '', field: 'channelCode',sortable:true},
        {title: '', field: 'suplier',sortable:true},
        {title: '售达方', field: 'soldTo',sortable:true},
        {title: '送达方', field: 'deliveryTo',sortable:true},
        {title: '采购订单金额（2位小数）', field: 'amount',sortable:true},
        {title: '采购日期', field: 'poTime',sortable:true},
        {title: '采购订单类型(ZBCR，采购入库订单)', field: 'type',sortable:true},
        {title: '收货人姓名', field: 'receiver',sortable:true},
        {title: '收货人移动电话', field: 'mobile',sortable:true},
        {title: '收货人固定电话', field: 'telephone',sortable:true},
        {title: '收货人所在省', field: 'province',sortable:true},
        {title: '收货人所在市', field: 'city',sortable:true},
        {title: '收货人所在区/县', field: 'county',sortable:true},
        {title: '收货人地址', field: 'address',sortable:true},
        {title: '采购订单状态，100：新建 200：完成', field: 'status',sortable:true},
        {title: '创建时间', field: 'createTime',sortable:true},
        {title: '更新时间', field: 'updateTime',sortable:true},
  ]],
  toolbar: '#datagridToolbar_purchaseOrder',
  striped: true,
  pagination: true,
  rownumbers: true,
};
$(function () {
  var datagrid = $('#datagrid_purchaseOrder').datagrid(datagridOptions_purchaseOrder);
  datagrid.datagrid('loadData',datagridData_purchaseOrder);
  //创建表头的菜单
  //CustomConfig.load(datagrid,"PurchaseOrder");
  //$("#searchPanel_purchaseOrder").panel('resize');

  $("#searchBtn_purchaseOrder").on('click', function (event) {
    var param = $('#paramForm_purchaseOrder').serializeObject();
    datagrid.datagrid({queryParams: param});
    event.preventDefault();
  });
  $("#addBtn_purchaseOrder").on('click', function (event) {
    $('#addForm_purchaseOrder').form('reset');
    $('#addForm_purchaseOrder').find('[__actType]').val('add');
    $('#addDlg_purchaseOrder').dialog({'title':'新增'});
    $('#addDlg_purchaseOrder').dialog('open');
  });
  $("#addDlgSaveBtn_purchaseOrder").on('click', function () {
    if(!$('#addForm_purchaseOrder').form('validate')){return;}
    var actType = $('#addForm_purchaseOrder').find('[__actType]').val();
    if(actType === 'add'){
      alert( '新增成功');
    }else{
      alert('编辑成功');
    }
    $('#addDlg_purchaseOrder').dialog('close');
  });
  $("#editBtn_purchaseOrder").on('click', function () {
    var selected = datagrid.datagrid('getSelected');
    $('#addDlg_purchaseOrder').dialog({'title':'修改'});
    if (selected !== null) {
      $('#addForm_purchaseOrder').form('load', selected);
      $('#addForm_purchaseOrder').find('[__actType]').val('edit');
      $('#addDlg_purchaseOrder').dialog('open');
    } else {
      alert('请选择一条数据');
    }
  });
  $("#deleteBtn_purchaseOrder").on('click',function (event) {
    event.preventDefault();
    var selected = datagrid.datagrid('getSelected');
    if (selected !== null) {
      confirm('确定删除？',function(r){
        if(r){
          alert('删除成功');
        }
      })

    }else{
      alert('请选择一条数据');
    }
  });
  $("#resetBtn_purchaseOrder").on('click',function (event) {
    event.preventDefault();
    $('#paramForm_purchaseOrder').form('reset');
  });
});
*/

$('#search').click(function () {
   alert("as");
	var product_group = $("#product_group").combobox("getValue");
	//如果是ALL，产品组设为空
	if(product_group=="ALL"){
		product_group="";
	}
	var channel = $("#channel").combobox("getValue");
	//如果是ALL，渠道设为空
	if(channel=="ALL"){
		channel="";
	}
	var cbsCategoryValue = $("#cbsCategory").combobox("getValue");
	//如果是ALL，品类设为空
	if(cbsCategoryValue=="全部"){
		cbsCategoryValue="";
	}
	//产品组保存
	$("#product_group_id_save").val(product_group);
	//渠道保存
    $("#ed_channel_id_save").val(channel);
  	//品类保存
	$("#cbsCategory_save").val(cbsCategoryValue);
	//订单号保存
	$("#order_id_save").val($("#order_id").val());
	//物料号保存
	$("#materials_id_save").val($("#materials_id").val());
	//库位保存
	$("#storage_id_save").val($("#storage_id").val());
	//状态保存
	var flow_flag = $("#flow_flag").combobox("getValues").join(",");
	//如果包含ALL，设置为空
	if(flow_flag.indexOf("ALL")>=0){
		 flow_flag="";
	}
	//订单类别保存
	var order_category = $("#order_category").combobox("getValues").join(",");
	//如果包含ALL，设置为空
	if(order_category.indexOf("ALL")>=0){
		 order_category="";
	}
	$("#order_category_save").val(order_category);
	//检索列表构筑
	if(datagrid){
		//grid刷新
	    $('#dataGrid').datagrid('load',
	    		{
		    	     report_year_week:$("#report_year_week").val(),
		    	     channel:channel,
		    	     product_group:product_group,
		    	     cbsCategory:$("#cbsCategory_save").val(),
		    	     order_id:$("#order_id").val(),
		    	     materials_id:$("#materials_id").val(),
		    	     storage_id:$("#storage_id").val(),
		    	     flow_flag:flow_flag,
					 order_category:order_category
	   	 });
	}else{
		//生成grid
	    datagrid = $('#dataGrid').datagrid({
	       url: "/purchase/findT2QueryCommitOrderList.html",
	        fit: true,
	        pagination: true,
	        singleSelect: false,
	        checkOnSelect:true,
	        pageSize: 100,
	        pageList: [1,2,100,200,300],
	        nowrap: false,
	        rownumbers: true,
	        queryParams: {
	        	 report_year_week:$("#report_year_week").val(),
	    	     channel:channel,
	    	     product_group:product_group,
	    	     cbsCategory:$("#cbsCategory_save").val(),
	    	     order_id:$("#order_id").val(),
	    	     materials_id:$("#materials_id").val(),
	    	     storage_id:$("#storage_id").val(),
	    	     flow_flag:flow_flag,
				 order_category:order_category
	        },
	        columns: [
	            [
	               {
	                    field: 'id',
	                    title: '序号',
	                    width: 10,
	                    align: 'center',
	                    hidden:true
	                },
	                {
	                   field: 'checked',
	                   width: 10,
	                   align: 'center',
	                   checkbox:true
	                },
					{
	                    field: 'order_category_name',
	                    title: '订单类别',
	                    width: 100,
	                    align: 'center'
	                },
	                {
	                    field: 'ed_channel_name',
	                    title: '渠道',
	                    width: 80,
	                    align: 'center'
	                },
	                {
	                	field:'category_id',
	                	title:'品类',
	                	width:100,
	                	align:'center'
	                },
	                {
	                    field: 'product_group_name',
	                    title: '产品组',
	                    width: 80,
	                    align: 'center'
	                },
	                {
	                	field:'order_id',
	                	title:'订单号',
	                	width:120,
	                	align:'center'
	                },{
	                	field:'materials_id',
	                	title:'物料号',
	                	width:100,
	                	align:'center'
	                },
	                {
	                	field:'storage_id',
	                	title:'库位',
	                	width:50,
	                	align:'center'
	                },
	                {
	                	field:'t2_delivery_prediction',
	                	title:'数量',
	                	width:50,
	                	align:'center'
	                },
	                {
	                	field:'price',
	                	title:'样表价格',
	                	width:80,
	                	align:'center'
	                },
	                {
	                	field:'amount',
	                	title:'金额',
	                	width:70,
	                	align:'center'
	                },
	                {
	                	field:'materials_desc',
	                	title:'型号',
	                	width:200,
	                	align:'center'
	                },
	                {
	                    field: 'flow_flag_name',
	                    title: '状态',
	                    width: 80,
	                    align: 'center'
	                },
	                {
                     field: 'order_type_name',
                     title: '订单类型',
                     width: 70,
                     align: 'center'
	             },
	             {
                     field: 'channel_commit_user',
                     title: '渠道提交人',
                     width: 100,
                     align: 'center'
	             },
	             {
                     field: 'channel_commit_time_display',
                     title: '渠道提交时间',
                     width: 150,
                     align: 'center'
	             },
				 {
	                 field: 'audit_depart_user',
	                 title: '产品部审核人',
	                 width: 100,
	                 align: 'center'
		         },
		         {
	                 field: 'audit_depart_time_display',
	                 title: '产品部审核时间',
	                 width: 150,
	                 align: 'center'
		         },
	             {
                     field: 'audit_user',
                     title: '内部审核人',
                     width: 100,
                     align: 'center'
	             },
	             {
                     field: 'audit_time_display',
                     title: '内部审核时间',
                     width: 150,
                     align: 'center'
	             },
	             {
	                    field: 'error_msg',
	                    title: '备注',
	                    width: 260,
	                    align: 'left'
	                }
	            ]
	        ]
	    });
	}
    $('#dataGrid').parent().find("div .datagrid-header-check").children("input[type='checkbox']").eq(0).attr("checked", false);
});
//点击提交
$('#commit').click(function(){
	if(!datagrid){
		$.messager.alert('提示','请查询！','info');
		return;	
	}
	//获得选中行
	var checkedItems = $('#dataGrid').datagrid('getChecked');
	var commitData = new Array();
	//判断是否存在未提交的行
	$.each(checkedItems, function(index, item){
		//flow_flag=0 未提交
		if(item.flow_flag==0){
			commitData.push(item.order_id);
		}
	}); 
	//判断是否存在未提交的行
	if(commitData==null||commitData.length==0){
		//alert("请至少选择一行状态为未提交的行！");
		$.messager.alert('错误','请至少选择一行状态为未提交的行！','error');
		return;
	}
	$.messager.confirm('确认','确定要提交吗？（只提交未提交的行）', function(r){
		if (r){
			 jQuery.ajax({
	             url: "/purchase/commitOrderList.html",   // 提交的页面
	             type: "POST",                   // 设置请求类型为"POST"，默认为"GET"
	             data:{"commitData": JSON.stringify(commitData)},
	             beforeSend:function(){
						$('#msg').show();
						$('#msgMask').show();
				 },
	             success: function (data) {
	            	 $('#msg').hide();
		     		 $('#msgMask').hide();
	            	 if(data.data != null) {$.messager.alert('错误',data.data,'error');}
	            	 else {
	            	$.messager.alert('提示','提交完成','info');
	             	$('#dataGrid').datagrid('reload', 
					             		 {report_year_week:$("#report_year_week").val(),
					       	    	     channel:$("#ed_channel_id_save").val(),
					       	    	     product_group:$("#product_group_id_save").val(),
					       	    	     cbsCategory:$("#cbsCategory_save").val(),
					       	    	     order_id:$("#order_id_save").val(),
					       	    	     materials_id:$("#materials_id_save").val(),
					       	    	     storage_id:$("#storage_id_save").val(),
					       	    	     flow_flag:$("#flow_flag_save").val(),
										 order_category:$("#order_category_save").val()
										 });										 
	             $('#dataGrid').parent().find("div .datagrid-header-check").children("input[type='checkbox']").eq(0).attr("checked", false);
	             }}
	 		});
		}
	});
});
//点击全部提交
$('#commitall').click(function(){
	if(!datagrid){
		$.messager.alert('提示','请查询！','info');
		return;	
	}
	$.messager.confirm('确认','确定要提交吗？（只提交未提交的行）', function(r){
		if(r){
			var params = {report_year_week:$("#report_year_week").val(),
	  	    	     channel:$("#ed_channel_id_save").val(),
	  	    	     cbsCategory:$("#cbsCategory_save").val(),
	   	    	     product_group:$("#product_group_id_save").val(),
	   	    	     order_id:$("#order_id_save").val(),
	   	    	     materials_id:$("#materials_id_save").val(),
	   	    	     storage_id:$("#storage_id_save").val(),
	   	    	     flow_flag:$("#flow_flag_save").val(),
					 order_category:$("#order_category_save").val()
					 };
			jQuery.ajax({
			url: "/purchase/commitAllOrderList.html",   // 提交的页面
			type: "POST",                   // 设置请求类型为"POST"，默认为"GET"
			data:params,
			beforeSend:function(){
				$('#msg').show();
				$('#msgMask').show();
		 	},
			success: function (data) {
				$('#msg').hide();
     			$('#msgMask').hide();
				if(data.data != null) {$.messager.alert('错误',data.data,'error');}
           	 else {
				$.messager.alert('提示','全部提交完成','info');
				$('#dataGrid').datagrid('reload', params);
				$('#dataGrid').parent().find("div .datagrid-header-check").children("input[type='checkbox']").eq(0).attr("checked", false);
			}}
			});
		}
	});
});
//点击删除
$('#delete').click(function(){
	if(!datagrid){
		$.messager.alert('提示','请查询！','info');
		return;	
	}
	//获得选中行
	var checkedItems = $('#dataGrid').datagrid('getChecked');
	var deleteData = new Array();
	//判断是否存在未提交或者待内部审核的行
	$.each(checkedItems, function(index, item){
		//flow_flag=0 未提交或者flow_flag=5 待内部审核或者flow_flag==3待产品部审核
		if(item.flow_flag==0 ||item.flow_flag==3|| item.flow_flag==5){
			deleteData.push(item.order_id);
		}
	}); 
	//判断是否存在未提交或者待内部审核的行
	if(deleteData==null||deleteData.length==0){
		//alert("请至少选择一行状态为未提交或者待内部审核的行！");
		$.messager.alert('错误','请至少选择一行状态为未提交或者待产品部审核或者待内部审核的行！','error');
		return;
	}
	$.messager.confirm('确认','确定要删除吗？（只能删除未提交或者待产品部审核或者待内部审核的行）', function(r){
		if(r){
			 jQuery.ajax({
	             url: "/purchase/deleteOrderList.html",   // 提交的页面
	             type: "POST",                   // 设置请求类型为"POST"，默认为"GET"
	             data:{"deleteData": JSON.stringify(deleteData)},
	             success: function (data) {
	            	$.messager.alert('提示','删除完成','info');
	             	$('#dataGrid').datagrid('load', 
					             		 {report_year_week:$("#report_year_week").val(),
					       	    	     channel:$("#ed_channel_id_save").val(),
					       	    	     cbsCategory:$("#cbsCategory_save").val(),
					       	    	     product_group:$("#product_group_id_save").val(),
					       	    	     order_id:$("#order_id_save").val(),
					       	    	     materials_id:$("#materials_id_save").val(),
					       	    	     storage_id:$("#storage_id_save").val(),
					       	    	     flow_flag:$("#flow_flag_save").val(),
										 order_category:$("#order_category_save").val()
										 });
	             	$('#dataGrid').parent().find("div .datagrid-header-check").children("input[type='checkbox']").eq(0).attr("checked", false);
	             }
	 		});
		}
	});
});
//点击导出
$('#export').click(function(){
	if(!datagrid){
		$.messager.alert('提示','请查询！','info');
		return;	
	}
	//获得选中行
	var checkedItems = $('#dataGrid').datagrid('getChecked');
	var exportData = new Array();
	//将订单号存入Array
	$.each(checkedItems, function(index, item){
			exportData.push(item.order_id);
	});
	$("#exportData").val(JSON.stringify(exportData));
	//判断是否都没选中
	if(exportData==null||exportData.length==0){
		//alert("请至少选择一行要导出的行！");
		$.messager.alert('错误','请至少选择一行要导出的行！','error');
		return;
	}
	$.messager.confirm('确认', '确定要导出吗？', function(r){
		if (r){
			$('#filterForm').attr("action", '/purchase/exportT2OrderList.export');
			$('#filterForm').submit();
		}
	});
});
//点击全部导出
$('#exportall').click(function(){
	if(!datagrid){
		$.messager.alert('提示','请查询！','info');
		return;	
	}
	$.messager.confirm('确认','确定要全部导出吗？', function(r){
		if (r){
			$('#filterForm').attr("action", '/purchase/exportAllT2OrderList.export');
			$('#filterForm').submit();
		}
	});
});
//点击下载模板
$("#downloadtmp").click(function(){
	$('#filterForm').attr("action", '/purchase/exportT2OrderModel.html');
    $('#filterForm').submit();
});
//点击导入
$('#import').click(function(){
    var report_year_week = $("#report_year_week").val().replace("年","").replace("周","");
    var url = '/purchase/importT2Order.html' + '?report_year_week=' + report_year_week;
    window.location.href=url;
    return false;
})
var datagrid;
$(function () {
	
	/*//接收当前周
	$("#report_year_week").val("$!currentweek");*/
	//取得渠道列表
	jQuery.getJSON("/purchase/getChannelsByAuth", function(result){
		var channel = result.data;
		//添加全部
		channel.unshift( {channelCode:'ALL',name:'全部'});
		$("#channel").combobox({
			  data:channel,
			  valueField:'channelCode',
			  textField:'name',
			  panelHeight:'auto',
			  editable:false,
			  value:'ALL'
		});
	});
	//取得产品组列表
	jQuery.getJSON("/purchase/getProductGroupByAuth", function(result){
		var productgroup = result.data;
		//添加全部
		productgroup.unshift( {value:'ALL',valueMeaning:'全部'});
		$("#product_group").combobox({
			 data:productgroup,
		     valueField:'value',
			 textField:'valueMeaning',
			 panelHeight:'300',
			 editable:false,
			 value:'ALL'
		});
	});
	//品类
	jQuery.getJSON("/purchase/getCbsCategoryByAuth", function(result){
		var JosnList=[];
		var cbsCategoryJson = {id: "全部", text: "全部"};
		JosnList.push(cbsCategoryJson)
		jQuery.each(result.data,function(i, v){
			var item={id:v,text:v};
			JosnList.push(item);
		});
		$("#cbsCategory").combobox({
			 data:JosnList,
		     valueField:'text',
			 textField:'text',
			 panelHeight:'auto',
			 editable:false,
			 value:'全部'
		});
	});
	//取得流程状态列表
	var valueSetId = "flow_flag";
	jQuery.getJSON("/purchase/getByValueSetId"+ "?valueSetId=" + valueSetId, function(result){
		var count = result.totalCount;
		var dataList = result.data;
		//添加全部
		dataList.unshift( {value:'ALL',value_meaning:'全部'});
		$("#flow_flag").combobox({
			 data:dataList,
		     valueField:'value',
			 textField:'value_meaning',
			 panelHeight:'auto',
			 editable:false,
			 value:'ALL'
		});
	});
	
	//取得订单类别列表
	var valueSetId = "order_category";
	jQuery.getJSON("/purchase/getByValueSetId"+ "?valueSetId=" + valueSetId, function(result){
		var count = result.totalCount;
		var dataList = result.data;
		//添加全部
		dataList.unshift( {value:'ALL',value_meaning:'全部'});
		$("#order_category").combobox({
			 data:dataList,
		     valueField:'value',
			 textField:'value_meaning',
			 panelHeight:'auto',
			 editable:false,
			 value:'ALL'
		});
	});
});


