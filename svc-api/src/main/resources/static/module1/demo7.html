<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../static/third/bootstrap/css/bootstrap.min.css">
    <!--<link rel="stylesheet" href="/static/third/bootstrap/css/bootstrap-theme.min.css">-->
    <link rel="stylesheet" href="../static/third/adminlte/css/AdminLTE.min.css">
    <!--<link rel="stylesheet" href="/static/third/adminlte/css/skins/_all-skins.min.css">-->
    <link rel="stylesheet" href="../static/third/font-awesome/css/font-awesome.min.css">
    <!--<link rel="stylesheet" href="/static/third/ionicons/css/ionicons.min.css">-->

    <!--  <link rel="stylesheet" href="/static/third/easyui/themes/material/easyui.css">
      <link rel="stylesheet" href="/static/third/easyui/themes/color.css">
      <link rel="stylesheet" href="/static/third/easyui/themes/icon.css">-->

    <link rel="stylesheet" href="../static/third/easyui/themes/insdep/easyui.css">
    <link rel="stylesheet" href="../static/third/easyui/themes/insdep/easyui_animation.css">
    <link rel="stylesheet" href="../static/third/easyui/themes/insdep/easyui_plus.css">
    <!--<link rel="stylesheet" href="/static/third/easyui/themes/insdep/insdep_theme_default.css">-->
    <link rel="stylesheet" href="../static/third/easyui/themes/insdep/icon.css">


    <link rel="stylesheet" href="../static/css/common.css">
    <title>测试页面</title>
    <script src="../static/third/jquery.js"></script>
    <script src="../static/third/bootstrap/js/bootstrap.min.js"></script>
    <script src="../static/third/easyui/jquery.easyui.min.js"></script>
    <script src="../static/third/easyui/themes/insdep/jquery.insdep-extend.min.js"></script>
    <script src="../static/third/easyui/locale/easyui-lang-zh_CN.js"></script>
    <script src="../static/js/utils.js"></script>
    <script src="../static/js/customConfig.js"></script>
    <script src="../static/js/easyui-extention_ws.js"></script>
    <!--<script src="/static/third/adminlte/js/app.js"></script>-->
    <script src="../static/js/i18n/zh_CN.js"></script>
</head>

<body class="iframe-body">


<div id="datagridToolbar_dmmtlPbcsMtlMeasure">
    <div class="slide_up_span open" onclick="slideUpSlideClk(this);">
        <div class="slide_line fa fa-window-minimize"></div>
        <div class="slide_line fa fa-window-minimize"></div>
        <div class="slide_line fa fa-window-minimize"></div>
        <div class="slide_line fa fa-window-minimize"></div>
        <div class="slide_line fa fa-window-minimize"></div>
        <div class="slide_line fa fa-window-minimize"></div>
        <div class="slide_line fa fa-window-minimize"></div>
        <div class="slide_line fa fa-window-minimize"></div>
        <div class="slide_line fa fa-window-minimize"></div>
        <div class="slide_circle fa fa-map-marker"></div>
    </div>
    <form id="paramForm_dmmtlPbcsMtlMeasure" class="param-form">
        <div class="search-panel">
            <div class="search-row">
                <span class="search-row-label">LBX单号</span>
                <input class="easyui-datebox" name="periodCode"/>
            </div>
            <div class="search-row">
                <span class="search-row-label">85单号</span>
                <input class="easyui-datebox" name="periodCode"/>
            </div>
            <div class="search-row">
			<span class="search-row-label">
			  提报周
			</span>
                <input class="easyui-textbox" id="report_year_week" name="raiseLm" disabled value="2017年43周"/>
            </div>
            <div class="search-row">
			<span class="search-row-label">
			  渠道
			</span>
                <select class="easyui-combobox" id="channel" name="productCode" style="width: 174px;">
                    <option >全部</option>
                    <option value="2">大客户渠道</option>
                    <option value="3">京东渠道</option>
                    <option value="4">天猫渠道</option>
                </select>
            </div>
            <div class="search-row">
			<span class="search-row-label">
			  品类
			</span>
                <select class="easyui-combobox" id="cbsCategory" name="platformCode" style="width: 174px;">
                    <option>全部</option>
                    <option value="AA">AA-冰箱</option>
                    <option value="AB">AB-冷柜</option>
                    <option value="DA">DA-波轮洗衣机</option>
                    <option value="DB">DB-滚筒洗衣机</option>
                    <option value="CA">CA-家用空调</option>
                    <option value="BA">BA-中央空调</option>
                    <option value="BB">BB-商用空调</option>
                    <option value="FA">FA-电热水器</option>
                    <option value="FB">FB-燃气热水器</option>
                    <option value="FC">FC-太阳热水器</option>
                    <option value="FD">FD-微波炉</option>
                    <option value="GA">GA-洗碗机</option>
                    <option value="GB">GB-燃气灶</option>
                    <option value="GC">GC-吸排油烟机</option>
                    <option value="GD">GD-消毒柜</option>
                    <option value="EA">EA-平板电视</option>
                    <option value="GF">GF-烤箱</option>
                    <option value="BD">BD-商用柜嵌空调</option>
                    <option value="GE">GE-电风扇</option>
                </select>
            </div>
            <div class="search-row">
			<span class="search-row-label">
			  产品组
			</span>
                <select class="easyui-combobox" id="product_group" name="xwCode" style="width: 174px;">
                    <option>全部</option>
                    <option value="AA">AA-冰箱</option>
                    <option value="AB">AB-冷柜</option>
                    <option value="DA">DA-波轮洗衣机</option>
                    <option value="DB">DB-滚筒洗衣机</option>
                    <option value="CA">CA-家用空调</option>
                    <option value="BA">BA-中央空调</option>
                    <option value="BB">BB-商用空调</option>
                    <option value="FA">FA-电热水器</option>
                    <option value="FB">FB-燃气热水器</option>
                    <option value="FC">FC-太阳热水器</option>
                    <option value="FD">FD-微波炉</option>
                    <option value="GA">GA-洗碗机</option>
                    <option value="GB">GB-燃气灶</option>
                    <option value="GC">GC-吸排油烟机</option>
                    <option value="GD">GD-消毒柜</option>
                    <option value="EA">EA-平板电视</option>
                    <option value="GF">GF-烤箱</option>
                    <option value="BD">BD-商用柜嵌空调</option>
                    <option value="GE">GE-电风扇</option>
                </select>
            </div>
            <div class="search-row">
			<span class="search-row-label">
			 订单号
			</span>
                <input  class="easyui-textbox" id="order_id" name="tyMtd"/>
            </div>
            <div class="search-row">
			<span class="search-row-label">
			  物料号
			</span>
                <input class="easyui-textbox" id="materials_id" name="lyMtd"/>
            </div>
            <div class="search-row">
			<span class="search-row-label">
			  库位
			</span>
                <input class="easyui-textbox" id="storage_id" name="raiseM"/>
            </div>
            <div class="search-row">
			<span class="search-row-label">
			  状态
			</span>
                <select class="easyui-combobox" id="flow_flag" name="xwCode" style="width: 174px;">
                    <option>全部</option>
                    <option value="AA">未提交</option>
                    <option value="AB">已提交</option>
                    <option value="DA">提交失败</option>
                </select>
            </div>
            <div class="search-row">
			<span class="search-row-label">
			  订单类别
			</span>
                <input class="easyui-combobox" id="order_category" name="raiseLm"/>
            </div>
        </div>
        <a href="#" class="easyui-linkbutton" id="search" "
           data-options="iconCls:'icon-search',plain:true">查询</a>
        <a href="#" class="easyui-linkbutton" id="import"
           data-options="iconCls:'icon-add',plain:true">导入</a>
        <a href="#" class="easyui-linkbutton" id="addBtn_dmmtlPbcsMtlMeasure"
           data-options="iconCls:'icon-ok',plain:true">提交</a>
        <a href="#" class="easyui-linkbutton" id="addBtn_dmmtlPbcsMtlMeasur"
           data-options="iconCls:'icon-ok',plain:true">全部提交</a>
        <a href="#" class="easyui-linkbutton" id="deleteBtn_dmmtlPbcsMtlMeasure"
           data-options="iconCls:'icon-remove',plain:true">删除</a>
        <a href="#" class="easyui-linkbutton" id="editBtn_dmmtlPbcsMtlMeasure"
           data-options="iconCls:'icon-save',plain:true">导出</a>
        <a href="#" class="easyui-linkbutton" id="editBtn_dmmtlPbcsMtlMeasur"
           data-options="iconCls:'icon-save',plain:true">全部导出</a>
        <a href="#" class="easyui-linkbutton" id="editBtn_dmmtlPbcsMtlMeasu"
           data-options="iconCls:'icon-save',plain:true">下载模板</a>
    </form>
</div>
<div id="searchPanel_dmmtlPbcsMtlMeasure" class="easyui-panel"
     style="width:100%;height:60%;"
     data-options="iconCls:'glyphicon glyphicon-search',collapsed:false,
		collapsible:false">
    <table id="dataGrid">
        <tbody>
        </tbody>
    </table>
</div>
<div id="importDialog" data-options="title:'',resizable:true,modal:true" class="easyui-dialog add-dlg"
     style="width:400px;height:300px;"
     closed="true" buttons="#dlg-buttons_import">
    <form id="importForm" method="post">
        <div style="margin-bottom:20px">
            <div>文件:</div>
            <input class="easyui-filebox" name="file1" data-options="prompt:'请选择一个文件...'" style="width:100%"
                   required="true">
        </div>
    </form>
    <div id="dlg-buttons_import">
        <a href="#" class="easyui-linkbutton" id="importSave" iconCls="icon-ok">确认</a>
        <a href="#" class="easyui-linkbutton" iconCls="icon-cancel"
           onclick="javascript:$('#importDialog').dialog('close')">关闭</a>
    </div>
</div>
<div id="addDlg_dmmtlPbcsMtlMeasure" data-options="title:'',resizable:true,modal:true" class="easyui-dialog add-dlg"
     style="width:1200px;height:300px;"
     closed="true" buttons="#dlg-buttons_dmmtlPbcsMtlMeasure">
    <form id="addForm_dmmtlPbcsMtlMeasure" method="post">
        <input name="id" type="text" style="display:none;">
        <input __acttype="" type="hidden" value="add">

        <div class="fitem">
            <label>提报周</label>
            <input class="easyui-textbox" name="field0" required="true">
        </div>
        <div class="fitem">
            <label>产品组</label>
            <input class="easyui-textbox" name="field1" required="true">
        </div>
        <div class="fitem">
            <label>未提交</label>
            <input class="easyui-textbox" name="field2" required="true">
        </div>
        <div class="fitem">
            <label>已提交</label>
            <input class="easyui-textbox" name="field3" required="true">
        </div>
        <div class="fitem">
            <label>提交失败</label>
            <input class="easyui-textbox" name="field4" required="true">
        </div>
    </form>
    <div id="dlg-buttons_dmmtlPbcsMtlMeasure">
        <a href="#" class="easyui-linkbutton" id="addDlgSaveBtn_dmmtlPbcsMtlMeasure" iconCls="icon-ok">确认</a>
        <a href="#" class="easyui-linkbutton" iconCls="icon-cancel"
           onclick="javascript:$('#addDlg_dmmtlPbcsMtlMeasure').dialog('close')">关闭</a>
    </div>
</div>
<script type="application/javascript">
$('#search').click(function () {
		var product_group = $("#product_group").combobox("getValue");
		//如果是ALL，产品组设为空
		if(product_group=="全部"){
			product_group="";
		}
		var channel = $("#channel").combobox("getValue");
		//如果是ALL，渠道设为空
		if(channel=="全部"){
			channel="";
		}
		var cbsCategoryValue = $("#cbsCategory").combobox("getValue");
		//如果是ALL，品类设为空
		if(cbsCategoryValue=="全部"){
			cbsCategoryValue="";
		}
		//产品组保存
		$("#product_group_id_save").val(product_group);
		//渠道保存
	    $("#ed_channel_id_save").val(channel);
	  	//品类保存
		$("#cbsCategory_save").val(cbsCategoryValue);
		//订单号保存
		$("#order_id_save").val($("#order_id").val());
		//物料号保存
		$("#materials_id_save").val($("#materials_id").val());
		//库位保存
		$("#storage_id_save").val($("#storage_id").val());
		//状态保存
		var flow_flag = $("#flow_flag").combobox("getValues").join(",");
		//如果包含ALL，设置为空
		if(flow_flag.indexOf("全部")>=0){
			 flow_flag="";
		}
		//订单类别保存
		var order_category = $("#order_category").combobox("getValues").join(",");
		//如果包含ALL，设置为空
		if(order_category.indexOf("ALL")>=0){
			 order_category="";
		}
		$("#order_category_save").val(order_category);
		//检索列表构筑
		if(datagrid){
			//grid刷新
		    $('#dataGrid').datagrid('load',
		    		{
			    	     report_year_week:$("#report_year_week").val(),
			    	     channel:channel,
			    	     product_group:product_group,
			    	     cbsCategory:$("#cbsCategory_save").val(),
			    	     order_id:$("#order_id").val(),
			    	     materials_id:$("#materials_id").val(),
			    	     storage_id:$("#storage_id").val(),
			    	     flow_flag:flow_flag,
						 order_category:order_category
		   	 });
		}else{
			//生成grid
		    datagrid = $('#dataGrid').datagrid({
		       url: "/purchase/findT2QueryCommitOrderList.html",
		        fit: true,
		        pagination: true,
		        singleSelect: false,
		        checkOnSelect:true,
		        pageSize: 100,
		        pageList: [1,2,100,200,300],
		        nowrap: false,
		        rownumbers: true,
		        queryParams: {
		        	 report_year_week:$("#report_year_week").val(),
		    	     channel:channel,
		    	     product_group:product_group,
		    	     cbsCategory:$("#cbsCategory_save").val(),
		    	     order_id:$("#order_id").val(),
		    	     materials_id:$("#materials_id").val(),
		    	     storage_id:$("#storage_id").val(),
		    	     flow_flag:flow_flag,
					 order_category:order_category
		        },
		        columns: [
		            [
		               {
		                    field: 'id',
		                    title: '序号',
		                    width: 10,
		                    align: 'center',
		                    hidden:true
		                },
		                {
		                   field: 'checked',
		                   width: 10,
		                   align: 'center',
		                   checkbox:true
		                },
						{
		                    field: 'order_category_name',
		                    title: '订单类别',
		                    width: 100,
		                    align: 'center'
		                },
		                {
		                    field: 'ed_channel_name',
		                    title: '渠道',
		                    width: 80,
		                    align: 'center'
		                },
		                {
		                	field:'category_id',
		                	title:'品类',
		                	width:100,
		                	align:'center'
		                },
		                {
		                    field: 'product_group_name',
		                    title: '产品组',
		                    width: 80,
		                    align: 'center'
		                },
		                {
		                	field:'order_id',
		                	title:'订单号',
		                	width:120,
		                	align:'center'
		                },{
		                	field:'materials_id',
		                	title:'物料号',
		                	width:100,
		                	align:'center'
		                },
		                {
		                	field:'storage_id',
		                	title:'库位',
		                	width:50,
		                	align:'center'
		                },
		                {
		                	field:'t2_delivery_prediction',
		                	title:'数量',
		                	width:50,
		                	align:'center'
		                },
		                {
		                	field:'price',
		                	title:'样表价格',
		                	width:80,
		                	align:'center'
		                },
		                {
		                	field:'amount',
		                	title:'金额',
		                	width:70,
		                	align:'center'
		                },
		                {
		                	field:'materials_desc',
		                	title:'型号',
		                	width:200,
		                	align:'center'
		                },
		                {
		                    field: 'flow_flag_name',
		                    title: '状态',
		                    width: 80,
		                    align: 'center'
		                },
		                {
	                     field: 'order_type_name',
	                     title: '订单类型',
	                     width: 70,
	                     align: 'center'
		             },
		             {
	                     field: 'channel_commit_user',
	                     title: '渠道提交人',
	                     width: 100,
	                     align: 'center'
		             },
		             {
	                     field: 'channel_commit_time_display',
	                     title: '渠道提交时间',
	                     width: 150,
	                     align: 'center'
		             },
					 {
		                 field: 'audit_depart_user',
		                 title: '产品部审核人',
		                 width: 100,
		                 align: 'center'
			         },
			         {
		                 field: 'audit_depart_time_display',
		                 title: '产品部审核时间',
		                 width: 150,
		                 align: 'center'
			         },
		             {
	                     field: 'audit_user',
	                     title: '内部审核人',
	                     width: 100,
	                     align: 'center'
		             },
		             {
	                     field: 'audit_time_display',
	                     title: '内部审核时间',
	                     width: 150,
	                     align: 'center'
		             },
		             {
		                    field: 'error_msg',
		                    title: '备注',
		                    width: 260,
		                    align: 'left'
		                }
		            ]
		        ]
		    });
		}
	    $('#dataGrid').parent().find("div .datagrid-header-check").children("input[type='checkbox']").eq(0).attr("checked", false);
	});
	//点击导入
	$('#import').click(function(){
		debugger;
	    var report_year_week = $("#report_year_week").val().replace("年","").replace("周","");
	    var url = '/purchase/importT2Order.html' + '?report_year_week=' + report_year_week;
	    window.location.href=url;
	    return false;
	})
	//点击提交
	$('#commit').click(function(){
		if(!datagrid){
			$.messager.alert('提示','请查询！','info');
			return;	
		}
		//获得选中行
		var checkedItems = $('#dataGrid').datagrid('getChecked');
		var commitData = new Array();
		//判断是否存在未提交的行
		$.each(checkedItems, function(index, item){
			//flow_flag=0 未提交
			if(item.flow_flag==0){
				commitData.push(item.order_id);
			}
		}); 
		//判断是否存在未提交的行
		if(commitData==null||commitData.length==0){
			//alert("请至少选择一行状态为未提交的行！");
			$.messager.alert('错误','请至少选择一行状态为未提交的行！','error');
			return;
		}
		$.messager.confirm('确认','确定要提交吗？（只提交未提交的行）', function(r){
			if (r){
				 jQuery.ajax({
		             url: "/purchase/commitOrderList.html",   // 提交的页面
		             type: "POST",                   // 设置请求类型为"POST"，默认为"GET"
		             data:{"commitData": JSON.stringify(commitData)},
		             beforeSend:function(){
							$('#msg').show();
							$('#msgMask').show();
					 },
		             success: function (data) {
		            	 $('#msg').hide();
			     		 $('#msgMask').hide();
		            	 if(data.data != null) {$.messager.alert('错误',data.data,'error');}
		            	 else {
		            	$.messager.alert('提示','提交完成','info');
		             	$('#dataGrid').datagrid('reload', 
						             		 {report_year_week:$("#report_year_week").val(),
						       	    	     channel:$("#ed_channel_id_save").val(),
						       	    	     product_group:$("#product_group_id_save").val(),
						       	    	     cbsCategory:$("#cbsCategory_save").val(),
						       	    	     order_id:$("#order_id_save").val(),
						       	    	     materials_id:$("#materials_id_save").val(),
						       	    	     storage_id:$("#storage_id_save").val(),
						       	    	     flow_flag:$("#flow_flag_save").val(),
											 order_category:$("#order_category_save").val()
											 });										 
		             $('#dataGrid').parent().find("div .datagrid-header-check").children("input[type='checkbox']").eq(0).attr("checked", false);
		             }}
		 		});
			}
		});
	});
	//点击全部提交
	$('#commitall').click(function(){
		if(!datagrid){
			$.messager.alert('提示','请查询！','info');
			return;	
		}
		$.messager.confirm('确认','确定要提交吗？（只提交未提交的行）', function(r){
			if(r){
				var params = {report_year_week:$("#report_year_week").val(),
		  	    	     channel:$("#ed_channel_id_save").val(),
		  	    	     cbsCategory:$("#cbsCategory_save").val(),
		   	    	     product_group:$("#product_group_id_save").val(),
		   	    	     order_id:$("#order_id_save").val(),
		   	    	     materials_id:$("#materials_id_save").val(),
		   	    	     storage_id:$("#storage_id_save").val(),
		   	    	     flow_flag:$("#flow_flag_save").val(),
						 order_category:$("#order_category_save").val()
						 };
				jQuery.ajax({
				url: "/purchase/commitAllOrderList.html",   // 提交的页面
				type: "POST",                   // 设置请求类型为"POST"，默认为"GET"
				data:params,
				beforeSend:function(){
					$('#msg').show();
					$('#msgMask').show();
			 	},
				success: function (data) {
					$('#msg').hide();
	     			$('#msgMask').hide();
					if(data.data != null) {$.messager.alert('错误',data.data,'error');}
	           	 else {
					$.messager.alert('提示','全部提交完成','info');
					$('#dataGrid').datagrid('reload', params);
					$('#dataGrid').parent().find("div .datagrid-header-check").children("input[type='checkbox']").eq(0).attr("checked", false);
				}}
				});
			}
		});
	});
	//点击删除
	$('#delete').click(function(){
		if(!datagrid){
			$.messager.alert('提示','请查询！','info');
			return;	
		}
		//获得选中行
		var checkedItems = $('#dataGrid').datagrid('getChecked');
		var deleteData = new Array();
		//判断是否存在未提交或者待内部审核的行
		$.each(checkedItems, function(index, item){
			//flow_flag=0 未提交或者flow_flag=5 待内部审核或者flow_flag==3待产品部审核
			if(item.flow_flag==0 ||item.flow_flag==3|| item.flow_flag==5){
				deleteData.push(item.order_id);
			}
		}); 
		//判断是否存在未提交或者待内部审核的行
		if(deleteData==null||deleteData.length==0){
			//alert("请至少选择一行状态为未提交或者待内部审核的行！");
			$.messager.alert('错误','请至少选择一行状态为未提交或者待产品部审核或者待内部审核的行！','error');
			return;
		}
		$.messager.confirm('确认','确定要删除吗？（只能删除未提交或者待产品部审核或者待内部审核的行）', function(r){
			if(r){
				 jQuery.ajax({
		             url: "/purchase/deleteOrderList.html",   // 提交的页面
		             type: "POST",                   // 设置请求类型为"POST"，默认为"GET"
		             data:{"deleteData": JSON.stringify(deleteData)},
		             success: function (data) {
		            	$.messager.alert('提示','删除完成','info');
		             	$('#dataGrid').datagrid('load', 
						             		 {report_year_week:$("#report_year_week").val(),
						       	    	     channel:$("#ed_channel_id_save").val(),
						       	    	     cbsCategory:$("#cbsCategory_save").val(),
						       	    	     product_group:$("#product_group_id_save").val(),
						       	    	     order_id:$("#order_id_save").val(),
						       	    	     materials_id:$("#materials_id_save").val(),
						       	    	     storage_id:$("#storage_id_save").val(),
						       	    	     flow_flag:$("#flow_flag_save").val(),
											 order_category:$("#order_category_save").val()
											 });
		             	$('#dataGrid').parent().find("div .datagrid-header-check").children("input[type='checkbox']").eq(0).attr("checked", false);
		             }
		 		});
			}
		});
	});
	//点击导出
	$('#export').click(function(){
		if(!datagrid){
			$.messager.alert('提示','请查询！','info');
			return;	
		}
		//获得选中行
		var checkedItems = $('#dataGrid').datagrid('getChecked');
		var exportData = new Array();
		//将订单号存入Array
		$.each(checkedItems, function(index, item){
				exportData.push(item.order_id);
		});
		$("#exportData").val(JSON.stringify(exportData));
		//判断是否都没选中
		if(exportData==null||exportData.length==0){
			//alert("请至少选择一行要导出的行！");
			$.messager.alert('错误','请至少选择一行要导出的行！','error');
			return;
		}
		$.messager.confirm('确认', '确定要导出吗？', function(r){
			if (r){
				$('#filterForm').attr("action", '/purchase/exportT2OrderList.export');
				$('#filterForm').submit();
			}
		});
	});
	//点击全部导出
	$('#exportall').click(function(){
		if(!datagrid){
			$.messager.alert('提示','请查询！','info');
			return;	
		}
		$.messager.confirm('确认','确定要全部导出吗？', function(r){
			if (r){
				$('#filterForm').attr("action", '/purchase/exportAllT2OrderList.export');
				$('#filterForm').submit();
			}
		});
	});
	//点击下载模板
	$("#downloadtmp").click(function(){
		$('#filterForm').attr("action", '/purchase/exportT2OrderModel.html');
	    $('#filterForm').submit();
	});
	//点击导入
	$('#import').click(function(){
	    var report_year_week = $("#report_year_week").val().replace("年","").replace("周","");
	    var url = '/purchase/importT2Order.html' + '?report_year_week=' + report_year_week;
	    window.location.href=url;
	    return false;
	})
	var datagrid;
	$(function () {
		
		/*//接收当前周
		$("#report_year_week").val("$!currentweek");*/
		//取得渠道列表
		jQuery.getJSON("/purchase/getChannelsByAuth", function(result){
			var channel = result.data;
			//添加全部
			channel.unshift( {channelCode:'ALL',name:'全部'});
			$("#channel").combobox({
				  data:channel,
				  valueField:'channelCode',
				  textField:'name',
				  panelHeight:'auto',
				  editable:false,
				  value:'ALL'
			});
		});
		//取得产品组列表
		jQuery.getJSON("/purchase/getProductGroupByAuth", function(result){
			var productgroup = result.data;
			//添加全部
			productgroup.unshift( {value:'ALL',valueMeaning:'全部'});
			$("#product_group").combobox({
				 data:productgroup,
			     valueField:'value',
				 textField:'valueMeaning',
				 panelHeight:'300',
				 editable:false,
				 value:'ALL'
			});
		});
		//品类
		jQuery.getJSON("/purchase/getCbsCategoryByAuth", function(result){
			var JosnList=[];
			var cbsCategoryJson = {id: "全部", text: "全部"};
			JosnList.push(cbsCategoryJson)
			jQuery.each(result.data,function(i, v){
				var item={id:v,text:v};
				JosnList.push(item);
			});
			$("#cbsCategory").combobox({
				 data:JosnList,
			     valueField:'text',
				 textField:'text',
				 panelHeight:'auto',
				 editable:false,
				 value:'全部'
			});
		});
		//取得流程状态列表
		var valueSetId = "flow_flag";
		jQuery.getJSON("/purchase/getByValueSetId"+ "?valueSetId=" + valueSetId, function(result){
			var count = result.totalCount;
			var dataList = result.data;
			//添加全部
			dataList.unshift( {value:'ALL',value_meaning:'全部'});
			$("#flow_flag").combobox({
				 data:dataList,
			     valueField:'value',
				 textField:'value_meaning',
				 panelHeight:'auto',
				 editable:false,
				 value:'ALL'
			});
		});
		
		//取得订单类别列表
		var valueSetId = "order_category";
		jQuery.getJSON("/purchase/getByValueSetId"+ "?valueSetId=" + valueSetId, function(result){
			var count = result.totalCount;
			var dataList = result.data;
			//添加全部
			dataList.unshift( {value:'ALL',value_meaning:'全部'});
			$("#order_category").combobox({
				 data:dataList,
			     valueField:'value',
				 textField:'value_meaning',
				 panelHeight:'auto',
				 editable:false,
				 value:'ALL'
			});
		});
	});
</script>
<script src="../static/js/report/dmmtlPbcsMtlMeasureIndex.js"></script>
</body>
</html>