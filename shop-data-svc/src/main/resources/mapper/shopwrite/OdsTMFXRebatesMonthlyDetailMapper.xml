<?xml version="1.0" encoding="UTF-8" ?>
<!--
  ~ Code generated by CodeGen
  -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.haier.shop.dao.settleCenter.OdsTMFXRebatesMonthlyDetailDao">
    <resultMap id="BaseResultMap" type="com.haier.shop.model.OdsTMFXRebatesMonthlyDetail">
        <id column="id" property="id"/>
        <result column="year" property="year"/>
        <result column="month" property="month"/>
        <result column="ecology_shop" property="ecologyShop"/>
        <result column="category" property="category"/>
        <result column="industry" property="industry"/>
        <result column="sku" property="sku"/>
        <result column="model_des" property="modelDes"/>
        <result column="brand" property="brand"/>
        <result column="sale_number" property="saleNumber"/>
        <result column="sale_amount" property="saleAmount"/>
        <result column="type" property="type"/>
        <result column="base_point" property="basePoint"/>
        <result column="extra_rebate" property="extraRebate"/>
        <result column="base_rebates_amount" property="baseRebatesAmount"/>
        <result column="extra_rebates_amount" property="extraRebatesAmount"/>
        <result column="monthly_cash_amount" property="monthlyCashAmount"/>
        <result column="step_point" property="stepPoint"/>
        <result column="mark_point" property="markPoint"/>
        <result column="step_rebates_amount" property="stepRebatesAmount"/>
        <result column="mark_rebates_amount" property="markRebatesAmount"/>
        <result column="fixed_amount" property="fixedAmount"/>
        <result column="sku_step_point" property="skuStepPoint"/>
        <result column="sku_step_rebates_amount" property="skuStepRebatesAmount"/>
        <result column="fixed_point" property="fixedPoint"/>
        <result column="amount_point" property="amountPoint"/>
        <result column="amount_step_rebates" property="amountStepRebates"/>

        <result column="bt_step_point" property="btStepPoint"/>
        <result column="bt_step_rebates_amount" property="btStepRebatesAmount"/>
        <result column="bt_sku_step_point" property="btSkuStepPoint"/>
        <result column="bt_sku_step_rebates_amount" property="btSkuStepRebatesAmount"/>
        <result column="bt_fixed_point" property="btFixedPoint"/>
        <result column="bt_fixed_amount" property="btFixedAmount"/>
        <result column="bt_amount_point" property="btAmountPoint"/>
        <result column="bt_amount_step_rebates" property="btAmountStepRebates"/>
        <result column="bt_target" property="btTarget"/>
        <result column="bt_coefficient" property="btCoefficient"/>
        <result column="bt_calculation_type" property="btCalculationType"/>
        <result column="source" property="source"/>


    </resultMap>

    <sql id="tb">
        ods_tmfx_rebatesmonthly_detail
    </sql>

    <sql id="cols_all">
        id, <include refid="cols_exclude_id" />
    </sql>
    
    <sql id="cols_source">
    	t.id,
    	t.year, 
		t.month, 
		t.ecology_shop, 
		t.category, 
		t.industry, 
		t.sku, 
		t.model_des, 
		t.brand, 
		t.sale_number, 
		t.sale_amount, 
		t.type, 
		t.base_point, 
		t.extra_rebate, 
		t.base_rebates_amount, 
		t.extra_rebates_amount, 
		t.monthly_cash_amount, 
		t.step_point, 
		t.mark_point, 
		t.step_rebates_amount, 
		t.mark_rebates_amount, 
		t.fixed_amount, 
		t.sku_step_point, 
		t.sku_step_rebates_amount, 
		t.fixed_point, 
		t.amount_point, 
		t.amount_step_rebates,
		t.bt_step_point,
		t.bt_step_rebates_amount,
		t.bt_sku_step_point,
		t.bt_sku_step_rebates_amount,
		t.bt_fixed_point,
		t.bt_fixed_amount,
		t.bt_amount_point,
		t.bt_amount_step_rebates,
		t.bt_target,
		t.bt_coefficient,
		t.bt_calculation_type,
		IFNULL(o.parent ,t.source) as source
    	
    </sql>

    <sql id="cols_exclude_id">
        year, 
        month, 
        ecology_shop, 
        category, 
        industry, 
        sku, 
        model_des, 
        brand, 
        sale_number, 
        sale_amount, 
        type, 
        base_point, 
        extra_rebate, 
        base_rebates_amount, 
        extra_rebates_amount, 
        monthly_cash_amount, 
        step_point, 
        mark_point, 
        step_rebates_amount, 
        mark_rebates_amount, 
        fixed_amount, 
        sku_step_point, 
        sku_step_rebates_amount, 
        fixed_point, 
        amount_point, 
        amount_step_rebates,
        bt_step_point,
        bt_step_rebates_amount,
        bt_sku_step_point,
        bt_sku_step_rebates_amount,
        bt_fixed_point,
        bt_fixed_amount,
        bt_amount_point,
        bt_amount_step_rebates,
        bt_target,
        bt_coefficient,
        bt_calculation_type,
        source

        
    </sql>

    <sql id="vals">
        #{id},
        #{year}, 
        #{month}, 
        #{ecologyShop}, 
        #{category}, 
        #{industry}, 
        #{sku}, 
        #{modelDes}, 
        #{brand}, 
        #{saleNumber}, 
        #{saleAmount}, 
        #{type}, 
        #{basePoint}, 
        #{extraRebate}, 
        #{baseRebatesAmount}, 
        #{extraRebatesAmount}, 
        #{monthlyCashAmount}, 
        #{stepPoint}, 
        #{markPoint}, 
        #{stepRebatesAmount}, 
        #{markRebatesAmount}, 
        #{fixedAmount}, 
        #{skuStepPoint}, 
        #{skuStepRebatesAmount}, 
        #{fixedPoint}, 
        #{amountPoint}, 
        #{amountStepRebates},
        #{btStepPoint},
        #{btStepRebatesAmount},
        #{btSkuStepPoint},
        #{btSkuStepRebatesAmount},
        #{btFixedPoint},
        #{btFixedAmount},
        #{btAmountPoint},
        #{btAmountStepRebates},
        #{btTarget},
        #{btCoefficient},
        #{btCalculationType},
        #{source}

        
    </sql>

    <sql id="criteria">
        <if test="id != null">AND id = #{id}</if>
        <if test="year != null">AND year = #{year}</if>
        <if test="month != null">AND month = #{month}</if>
        <if test="ecologyShop != null">AND ecology_shop = #{ecologyShop}</if>
        <if test="category != null">AND category = #{category}</if>
        <if test="industry != null">AND industry = #{industry}</if>
        <if test="sku != null">AND sku = #{sku}</if>
        <if test="modelDes != null">AND model_des = #{modelDes}</if>
        <if test="brand != null">AND brand = #{brand}</if>
        <if test="saleNumber != null">AND sale_number = #{saleNumber}</if>
        <if test="saleAmount != null">AND sale_amount = #{saleAmount}</if>
        <if test="type != null">AND type = #{type}</if>
        <if test="basePoint != null">AND base_point = #{basePoint}</if>
        <if test="extraRebate != null">AND extra_rebate = #{extraRebate}</if>
        <if test="baseRebatesAmount != null">AND base_rebates_amount = #{baseRebatesAmount}</if>
        <if test="extraRebatesAmount != null">AND extra_rebates_amount = #{extraRebatesAmount}</if>
        <if test="monthlyCashAmount != null">AND monthly_cash_amount = #{monthlyCashAmount}</if>
        <if test="stepPoint != null">AND step_point = #{stepPoint}</if>
        <if test="markPoint != null">AND mark_point = #{markPoint}</if>
        <if test="stepRebatesAmount != null">AND step_rebates_amount = #{stepRebatesAmount}</if>
        <if test="markRebatesAmount != null">AND mark_rebates_amount = #{markRebatesAmount}</if>
        <if test="fixedAmount != null">AND fixed_amount = #{fixedAmount}</if>
        <if test="skuStepPoint != null">AND sku_step_point = #{skuStepPoint}</if>
        <if test="skuStepRebatesAmount != null">AND sku_step_rebates_amount = #{skuStepRebatesAmount}</if>
        <if test="fixedPoint != null">AND fixed_point = #{fixedPoint}</if>
        <if test="amountPoint != null">AND amount_point = #{amountPoint}</if>
        <if test="amountStepRebates != null">AND amount_step_rebates = #{amountStepRebates}</if>
        
    </sql>

    <insert id="create" parameterType="com.haier.shop.model.OdsTMFXRebatesMonthlyDetail">
        INSERT INTO <include refid="tb" />
        (<include refid="cols_all" />)
        VALUES
        (<include refid="vals" />)
    </insert>

    <insert id="creates" parameterType="list">
        INSERT INTO <include refid="tb" />
        (<include refid="cols_all" />)
        VALUES
        <foreach collection="list" separator="," item="item">
            (
            #{item.id},
            #{item.year}, 
            #{item.month}, 
            #{item.ecologyShop}, 
            #{item.category}, 
            #{item.industry}, 
            #{item.sku}, 
            #{item.modelDes}, 
            #{item.brand}, 
            #{item.saleNumber}, 
            #{item.saleAmount}, 
            #{item.type}, 
            #{item.basePoint}, 
            #{item.extraRebate}, 
            #{item.baseRebatesAmount}, 
            #{item.extraRebatesAmount}, 
            #{item.monthlyCashAmount}, 
            #{item.stepPoint}, 
            #{item.markPoint}, 
            #{item.stepRebatesAmount}, 
            #{item.markRebatesAmount}, 
            #{item.fixedAmount}, 
            #{item.skuStepPoint}, 
            #{item.skuStepRebatesAmount}, 
            #{item.fixedPoint}, 
            #{item.amountPoint}, 
            #{item.amountStepRebates}
            
            )
        </foreach>
    </insert>

    <select id="load" parameterType="long" resultMap="BaseResultMap" >
        SELECT <include refid="cols_all" /> FROM <include refid="tb" />
        WHERE id = #{id}
    </select>

    <update id="update" parameterType="com.haier.shop.model.OdsTMFXRebatesMonthlyDetail">
        UPDATE <include refid="tb"/>
        <set>
            <if test="year != null">year = #{year},</if>
            <if test="month != null">month = #{month},</if>
            <if test="ecologyShop != null">ecology_shop = #{ecologyShop},</if>
            <if test="category != null">category = #{category},</if>
            <if test="industry != null">industry = #{industry},</if>
            <if test="sku != null">sku = #{sku},</if>
            <if test="modelDes != null">model_des = #{modelDes},</if>
            <if test="brand != null">brand = #{brand},</if>
            <if test="saleNumber != null">sale_number = #{saleNumber},</if>
            <if test="saleAmount != null">sale_amount = #{saleAmount},</if>
            <if test="type != null">type = #{type},</if>
            <if test="basePoint != null">base_point = #{basePoint},</if>
            <if test="extraRebate != null">extra_rebate = #{extraRebate},</if>
            <if test="baseRebatesAmount != null">base_rebates_amount = #{baseRebatesAmount},</if>
            <if test="extraRebatesAmount != null">extra_rebates_amount = #{extraRebatesAmount},</if>
            <if test="monthlyCashAmount != null">monthly_cash_amount = #{monthlyCashAmount},</if>
            <if test="stepPoint != null">step_point = #{stepPoint},</if>
            <if test="markPoint != null">mark_point = #{markPoint},</if>
            <if test="stepRebatesAmount != null">step_rebates_amount = #{stepRebatesAmount},</if>
            <if test="markRebatesAmount != null">mark_rebates_amount = #{markRebatesAmount},</if>
            <if test="fixedAmount != null">fixed_amount = #{fixedAmount},</if>
            <if test="skuStepPoint != null">sku_step_point = #{skuStepPoint},</if>
            <if test="skuStepRebatesAmount != null">sku_step_rebates_amount = #{skuStepRebatesAmount},</if>
            <if test="fixedPoint != null">fixed_point = #{fixedPoint},</if>
            <if test="amountPoint != null">amount_point = #{amountPoint},</if>
            <if test="amountStepRebates != null">amount_step_rebates = #{amountStepRebates},</if>

            <if test="btStepPoint != null">bt_step_point = #{btStepPoint},</if>
            <if test="btStepRebatesAmount != null">bt_step_rebates_amount = #{btStepRebatesAmount},</if>
            <if test="btSkuStepPoint != null">bt_sku_step_point = #{btSkuStepPoint},</if>
            <if test="btSkuStepRebatesAmount != null">bt_sku_step_rebates_amount = #{btSkuStepRebatesAmount},</if>
            <if test="btFixedPoint != null">bt_fixed_point = #{btFixedPoint},</if>
            <if test="btFixedAmount != null">bt_fixed_amount = #{btFixedAmount},</if>
            <if test="btAmountPoint != null">bt_amount_point = #{btAmountPoint},</if>
            <if test="btAmountStepRebates != null">bt_amount_step_rebates = #{btAmountStepRebates},</if>
            <if test="btTarget != null">bt_target = #{btTarget},</if>
            <if test="btCoefficient != null">bt_coefficient = #{btCoefficient},</if>
            <if test="btCalculationType != null">bt_calculation_type = #{btCalculationType},</if>
            <if test="source != null">source = #{source},</if>

            id = #{id}
        </set>
        WHERE id = #{id}
    </update>

    <delete id="delete" parameterType="long">
        DELETE FROM <include refid="tb"/>
        WHERE id = #{id}
    </delete>

    <delete id="deletes" parameterType="list">
        DELETE FROM <include refid="tb"/>
        WHERE id IN
        <foreach collection="list" open="(" separator="," close=")" item="id">
            #{id}
        </foreach>
    </delete>

    <select id="list" parameterType="com.haier.shop.model.OdsTMFXRebatesMonthlyDetail" resultMap="BaseResultMap">
        SELECT <include refid="cols_all"/> FROM <include refid="tb"/>
        <where>
            <include refid="criteria"/>
        </where>
    </select>

    <sql id="pagingSql" >
        from <include refid="tb" /> t
          left join  ods_source_dictionary o
          on  o.source=t.source 
    </sql>
    <sql id="pagingWhere">
        <where>
            1=1
            <if test="param.year!=null and param.year!=''">
                and t.year = #{param.year}
            </if>
            <if test="param.month!=null and param.month!=''">
                and t.month = #{param.month}
            </if>
            <if test="param.ecologyShop!=null and param.ecologyShop!=''">
                and t.ECOLOGY_SHOP = #{param.ecologyShop,jdbcType=VARCHAR}
            </if>
            <if test="param.type!=null and param.type!=''">
                and t.TYPE = #{param.type,jdbcType=VARCHAR}
            </if>
            <if test="param.brand!=null and param.brand!=''">
                and t.brand = #{param.brand,jdbcType=VARCHAR}
            </if>
            <if test="param.industry!=null and param.industry!=''">
                and t.industry = #{param.industry,jdbcType=VARCHAR}
            </if>
            <if test="param.source!=null and param.source!=''">
                and o.parent =#{param.source,jdbcType=VARCHAR}
            </if>
            
        </where>
    </sql>
    <select id="count" parameterType="map" resultType="long">
        select  count(1)
        <include refid="pagingSql" />
        <include refid="pagingWhere" />
    </select>
    <select id="paging"   resultMap="BaseResultMap" >
        select
        <include refid="cols_source"/>
        <include refid="pagingSql" />
        <include refid="pagingWhere" />

        <!--        <if test="sort !=null and sort !=''">
                    ${sort} ${order},
                </if>-->

        LIMIT #{page.start}, #{page.pageSize}

    </select>



    <select id="export"   resultType="map" >
        select
        year,
        month,
        IFNULL(o.parent ,t.source) source,
        ecology_shop,
        category,
        industry,
        sku,
        model_des,
        brand,
        sale_number,
        sale_amount,
        (select case t.type when 'm' then '月度' when 'q' then '季度' when 'y' then'年度' end ) type,
        base_point,
        extra_rebate,
        base_rebates_amount,
        extra_rebates_amount,
        monthly_cash_amount,
        step_point,
        mark_point,
        step_rebates_amount,
        mark_rebates_amount,
        fixed_amount,
        sku_step_point,
        sku_step_rebates_amount,
        fixed_point,
        amount_point,
        amount_step_rebates,
        bt_step_point,
        bt_step_rebates_amount,
        bt_sku_step_point,
        bt_sku_step_rebates_amount,
        bt_fixed_point,
        bt_fixed_amount,
        bt_amount_point,
        bt_amount_step_rebates,
        bt_target,
        bt_coefficient,
        case bt_calculation_type
        WHEN 'target' THEN  '按目标'
        WHEN 'actual' THEN  '按实际'
        ELSE '' end  bt_calculation_type
        <include refid="pagingSql" />
        <include refid="pagingWhere" />

        <!--        <if test="sort !=null and sort !=''">
                    ${sort} ${order},
                </if>-->


    </select>

    <delete id="clearHistoryData">
        DELETE  FROM  <include refid="tb"/>
        WHERE 1=1
        <if test="year!=null and year!=''">
            and year = #{year,jdbcType=VARCHAR}
        </if>
        <if test="month!=null and month!=''">
            and month = #{month,jdbcType=VARCHAR}
        </if>
        <if test="type!=null and type!=''">
            and TYPE = #{type,jdbcType=VARCHAR}
        </if>
    </delete>
    <select id="findMonthlySummaryList" resultMap="BaseResultMap">
        select
        r.year,
        r.month,
        r.ecology_shop,
        r.industry,
        r.brand,
        IFNULL(sum(r.sale_amount),0) sale_amount,
        IFNULL(sum(r.base_rebates_amount),0) base_rebates_amount,
        IFNULL(sum(r.extra_rebates_amount),0) extra_rebates_amount,
        IFNULL(sum(r.monthly_cash_amount),0) monthly_cash_amount,
        IFNULL(sum(r.step_rebates_amount),0) step_rebates_amount,
        IFNULL(sum(r.mark_rebates_amount),0) mark_rebates_amount,
        IFNULL(sum(r.fixed_amount),0) fixed_amount,
        IFNULL(sum(r.sku_step_rebates_amount),0) sku_step_rebates_amount
        from ods_tmfx_rebatesmonthly_detail r
        where r.type ='m'
        <if test="year!=null and year!=''">
            and r.year = #{year,jdbcType=VARCHAR}
        </if>
        <if test="month!=null and month!=''">
            and r.month = #{month,jdbcType=VARCHAR}
        </if>
        group by
        r.year,
        r.month,
        r.ecology_shop,
        r.industry,
        r.brand
    </select>
    <select id="findAmountSummary" resultType="java.math.BigDecimal">
        select
        IFNULL(sum(sale_amount),0)sale_amount
        from ods_tmfx_rebatesmonthly_detail
        WHERE type = 'm'
        <if test="ecologyShop!=null and ecologyShop!=''">
            and ECOLOGY_SHOP = #{ecologyShop,jdbcType=VARCHAR}
        </if>
        <if test="year!=null and year!=''">
            and YEAR = #{year,jdbcType=VARCHAR}
        </if>
        <if test="month!=null and month!=''">
            and MONTH = #{month,jdbcType=VARCHAR}
        </if>
        <if test="brand!=null and brand!=''">
            and brand = #{brand,jdbcType=VARCHAR}
        </if>
        <if test="industry!=null and industry!=''">
            and industry = #{industry,jdbcType=VARCHAR}
        </if>
    </select>



    <sql id="pagingWhere2">
        <where>
            1=1 and TYPE = 'm'
            <if test="param.year!=null and param.year!=''">
                and year = #{param.year}
            </if>
            <if test="param.type!=null and param.type=='q'.toString() and param.month!=null and param.month=='Q1'.toString()">
                and month in ('01','02','03')
            </if>
            <if test="param.type!=null and param.type=='q'.toString() and param.month!=null and param.month=='Q2'.toString()">
                and month in ('04','05','06')
            </if>
            <if test="param.type!=null and param.type=='q'.toString() and param.month!=null and param.month=='Q3'.toString()">
                and month in ('07','08','09')
            </if>
            <if test="param.type!=null and param.type=='q'.toString() and param.month!=null and param.month=='Q4'.toString()">
                and month in ('10','11','12')
            </if>
            <if test="param.ecologyShop!=null and param.ecologyShop!=''">
                and ECOLOGY_SHOP = #{param.ecologyShop,jdbcType=VARCHAR}
            </if>
            <if test="param.brand!=null and param.brand!=''">
                and brand = #{param.brand,jdbcType=VARCHAR}
            </if>
            <if test="param.industry!=null and param.industry!=''">
                and industry = #{param.industry,jdbcType=VARCHAR}
            </if>
            <if test="param.sku != null  and param.sku!=''">
                AND sku =#{param.sku,jdbcType=VARCHAR}
            </if>
        </where>
    </sql>

    <select id="queryList"   resultMap="BaseResultMap" >
        select
        <include refid="cols_all"/>
        <include refid="pagingSql" />
        <include refid="pagingWhere2" />
    </select>

</mapper>