<?xml version="1.0" encoding="UTF-8" ?>
<!--
  ~ Code generated by CodeGen
  -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.haier.shop.dao.settleCenter.SettlementLogDao">
    <resultMap id="BaseResultMap" type="com.haier.shop.model.SettlementLog">
        <id column="id" property="id"/>
        <result column="year" property="year"/>
        <result column="month" property="month"/>
        <result column="type" property="type"/>
        <result column="status" property="status"/>
        <result column="status_date" property="statusDate"/>
        <result column="end_date" property="endDate"/>
        <result column="create_date" property="createDate"/>
        <result column="update_date" property="updateDate"/>
        <result column="source" property="source"/>
    </resultMap>

    <sql id="tb">
        ods_settlement_log
    </sql>

    <sql id="cols_all">
        id, <include refid="cols_exclude_id" />
    </sql>

    <sql id="cols_exclude_id">
        year, 
        month, 
        type, 
        status, 
        status_date, 
        end_date, 
        create_date, 
        update_date,
        source
    </sql>

    <sql id="vals">
        #{year}, 
        #{month}, 
        #{type}, 
        #{status}, 
        #{statusDate}, 
        #{endDate}, 
        #{createDate}, 
        #{updateDate},
        #{source}
    </sql>

    <sql id="criteria">
        <if test="id != null">AND id = #{id}</if>
        <if test="year != null">AND year = #{year}</if>
        <if test="month != null">AND month = #{month}</if>
        <if test="type != null">AND type = #{type}</if>
        <if test="status != null">AND status = #{status}</if>
        <if test="statusDate != null">AND status_date = #{statusDate}</if>
        <if test="endDate != null">AND end_date = #{endDate}</if>
        <if test="createDate != null">AND create_date = #{createDate}</if>
        <if test="updateDate != null">AND update_date = #{updateDate}</if>
        <if test="source != null">AND source = #{source}</if>
    </sql>

    <insert id="create" parameterType="com.haier.shop.model.SettlementLog" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO <include refid="tb" />
        (<include refid="cols_exclude_id" />)
        VALUES
        (<include refid="vals" />)
    </insert>

    <insert id="creates" parameterType="list">
        INSERT INTO <include refid="tb" />
        (<include refid="cols_exclude_id" />)
        VALUES
        <foreach collection="list" separator="," item="item">
            (
            #{item.year}, 
            #{item.month}, 
            #{item.type}, 
            #{item.status}, 
            #{item.statusDate}, 
            #{item.endDate}, 
            now(),
            #{item.updateDate},
            #{source}
            )
        </foreach>
    </insert>

    <select id="load" parameterType="long" resultMap="BaseResultMap" >
        SELECT <include refid="cols_all" /> FROM <include refid="tb" />
        WHERE id = #{id}
    </select>

    <update id="update" parameterType="com.haier.shop.model.SettlementLog">
        UPDATE <include refid="tb"/>
        <set>
            <if test="year != null">year = #{year},</if>
            <if test="month != null">month = #{month},</if>
            <if test="type != null">type = #{type},</if>
            <if test="status != null">status = #{status},</if>
            <if test="statusDate != null">status_date = #{statusDate},</if>
            <if test="endDate != null">end_date = #{endDate},</if>
            <if test="createDate != null">create_date = #{createDate},</if>
            <if test="updateDate != null">update_date = #{updateDate},</if>
			<if test="source != null">source = #{source},</if>
            update_date=now()
        </set>
        WHERE id = #{id}
    </update>

    <delete id="delete" parameterType="long">
        DELETE FROM <include refid="tb"/>
        WHERE id = #{id}
    </delete>

    <delete id="deletes" parameterType="list">
        DELETE FROM <include refid="tb"/>
        WHERE id IN
        <foreach collection="list" open="(" separator="," close=")" item="id">
            #{id}
        </foreach>
    </delete>

    <select id="list" parameterType="com.haier.shop.model.SettlementLog" resultMap="BaseResultMap">
        SELECT <include refid="cols_all"/> FROM <include refid="tb"/>
        <where>
            <include refid="criteria"/>
        </where>
    </select>

    <sql id="pagingSql" >
        <![CDATA[
        FROM <include refid="tb"/>

        ]]>
        <where>
            <include refid="criteria"/>
        </where>
    </sql>
    <select id="count" parameterType="map" resultType="long">
        SELECT count(1)
        <include refid="pagingSql" />
    </select>

    <select id="paging" parameterType="map" resultType="map">
        SELECT *
        <include refid="pagingSql"/>
        ORDER BY
        <if test="sort !=null and sort !=''">
            ${sort} ${order},
        </if>
        id DESC
        LIMIT #{limit} OFFSET ${offset}
    </select>

    <select id="queryLog" resultType="int">
        SELECT  count(1) from ods_settlement_log where status = '1' and source = #{source}
    </select>
    
    <select id="queryLogInfo" resultType="String">
        select CONCAT('计算期间：',t.`year`,'-',t.`month`,',计算类型为',case t.type WHEN 'y' THEN '年度' WHEN 'q' THEN '季度' ELSE '月度' end,'任务', '执行时间：',t.status_date,',执行结果为：',case t.`status` WHEN '1' THEN '正在执行' WHEN '2' THEN '执行失败' ELSE '完成' end ) info
        from ods_settlement_log t where t.source = #{source} ORDER BY id desc LIMIT 1
    </select>

</mapper>